/*
* MIT Licensed
* Copyright (c) 2012, Priit Pirita, atirip@yahoo.com
* https://github.com/atirip/multiclicker.js
*/
;(function(a,b){var c=a.document,d=c.documentElement,e=c.body,f=function(c,d){var e=this;this.holdDelay=0,this.clickDelay=300,this.doubleClick=!1,this.throttleClick=!0,this.fireOver=!0,this.callback=function(){},this.context=a,this.onclick=void 0,this.clickPassthruTags=["INPUT","TEXTAREA","SELECT","BUTTON","A"],this.distance=Math.pow(b.is.touch?10:5,2),this.capture=!1,this.androidPreventStart=!0,this.handleModifierEvents=!1,d=d||{};for(var f in d)d.hasOwnProperty(f)&&(this[f]=d[f]);this.clickDelay=this.doubleClick?this.clickDelay:5,this.clickPassthruLength=this.clickPassthruTags.length,this.iehandler=function(){e.handleEvent.call(e)},this.bind(b.events.start,c),document.addEventListener||this.bind(b.events.end,c),this.bind("gesturestart",c),this.bind("click",c),this.bind("dblclick",c),b.is.touch||(this.bind("DOMMouseScroll",c),this.bind("mousewheel",c))};f.prototype={startX:0,startY:0,pageX:0,pageY:0,fingers:0,moved:!1,started:!1,changed:!1,holdTimer:!1,holdFired:!1,clickTimer:!1,gesture:!1,squared:function(a){return Math.pow(a,2)},bind:function(a,b){b=b||c,b.addEventListener?b.addEventListener(a,this,this.capture):b.attachEvent&&b.attachEvent("on"+a,this.iehandler)},unbind:function(a,b){b=b||c,b.removeEventListener?b.removeEventListener(a,this,this.capture):b.detachEvent&&b.detachEvent("on"+a,this.iehandler)},stopPropagation:function(b){b.stopPropagation?b.stopPropagation():a.event&&(a.event.cancelBubble=!0)},preventDefault:function(b){b.preventDefault?b.preventDefault():a.event&&(a.event.returnValue=!1)},fire:function(a,b,c){return this.modifier&&this.handleModifierEvents&&(b.ctrlKey&&(this.modifier=17)||b.shiftKey&&(this.modifier=16)||b.altKey&&(this.modifier=18)||b.metaKey&&(this.modifier=91)||(this.modifier=b.which)),this.callback.call(this.context,a,b,{originalTarget:this.originalTarget,currentTarget:this.currentTarget,lastTarget:c?c:this.currentTarget,horizontal:this.horizontal,vertical:!this.horizontal,x:this.startX,y:this.startY,px:this.pageX,py:this.pageY,dx:this.pageX-this.startX,dy:this.pageY-this.startY,ddx:this.pageX-this.prevX,ddy:this.pageY-this.prevY,left:this.horizontal?this.left:!1,right:this.horizontal?!this.left:!1,up:this.horizontal?!1:this.left,down:this.horizontal?!1:!this.left,modifier:this.modifier},this)},clearTimer:function(a){return clearTimeout(a),!1},getXY:function(a,b,c){a.changedTouches&&a.changedTouches.length>0?(this[b]=a.changedTouches[0].pageX,this[c]=a.changedTouches[0].pageY):a.targetTouches&&a.targetTouches.length>0?(this[b]=a.targetTouches[0].pageX,this[c]=a.targetTouches[0].pageY):a.pageX||a.pageY?(this[b]=a.pageX,this[c]=a.pageY):(a.clientX||a.clientY)&&(this[b]=a.clientX+e.scrollLeft+d.scrollLeft,this[c]=a.clientY+e.scrollTop+d.scrollTop)},ignore:function(a){for(var b=this.clickPassthruLength;b--;)if(a.target.tagName===this.clickPassthruTags[b])return!0;return!1},handleEvent:function(d){var g,e=this,f=0;switch(d=d||a.event,null===d.which&&(d.which=d.charCode!==null?d.charCode:d.keyCode),d.target||(d.target=d.srcElement||c),d.target.nodeType===3&&(d.target=d.target.parentNode),!d.relatedTarget&&d.fromElement&&(d.relatedTarget=d.fromElement===d.target?d.toElement:d.fromElement),d.type){case"DOMMouseScroll":case"mousewheel":d.wheelDelta&&(f=d.wheelDelta/120),d.detail&&(f=-d.detail/3),this.startY=f,this.startX=0,d.axis!==void 0&&d.axis===d.HORIZONTAL_AXIS&&(this.startY=0,this.startX=-1*f),void 0!==d.wheelDeltaY&&(this.startY=d.wheelDeltaY/120),void 0!==d.wheelDeltaX&&(this.startX=-1*d.wheelDeltaX/120),this.originalTarget=this.currentTarget=d.target,this.horizontal=!!this.startX,this.left=this.horizontal?this.startX>0:0>this.startY,this.fire("wheel",d);break;case"gesturestart":this.gesture||(this.bind("gesturechange"),this.bind("gestureend"),this.gesture=!0,this.changed=!1);break;case"gesturechange":this.changed=!0;break;case"gestureend":this.gesture&&(this.unbind("gesturechange"),this.unbind("gestureend"),this.gesture=!1,this.changed||(this.fire("twofingertap",d),this.fire("stop",d)));break;case"dblclick":if(this.ignore(d))break;this.preventDefault(d),this.stopPropagation(d);break;case"click":if(this.onclick&&!this.modifier){if(this.ignore(d))break;this.preventDefault(d),this.stopPropagation(d)}break;case b.events.start:if(this.ignore(d))break;if(this.stopPropagation(d),this.androidPreventStart&&b.is.android&&d.preventDefault(),this.started)return!1;if(this.fingers=d.touches?d.touches.length:1,this.fingers>1)return(this.holdTimer||this.clickTimer)&&(this.holdTimer=this.clearTimer(this.holdTimer),this.clickTimer=this.clearTimer(this.clickTimer)),!1;if(this.modifier=16===d.which||17===d.which||18===d.which||91===d.which||d.ctrlKey||d.shiftKey||d.altKey||d.metaKey,!b.is.touch){var h;if(d.which?h=d.which==3:d.button&&(h=d.button==2),h)break}this.getXY(d,"startX","startY"),this.originalTarget=this.currentTarget=d.target,this.horizontal=!1,this.left=!1,this.bind(b.events.move),document.addEventListener&&this.bind(b.events.end),this.started=!0,this.holdFired=!1,this.moved=!1,this.dragged=!1,this.holdDelay&&(this.holdTimer=setTimeout(function(){e.holdFired=!0,e.holdTimer=!1,e.fire("hold",d)},this.holdDelay)),!this.clickTimer&&this.fire("start",d);break;case b.events.move:this.getXY(d,"pageX","pageY"),this.moved?(this.dragged&&this.fire("drag",d),this.fireOver&&(g=c.elementFromPoint(this.pageX,this.pageY),g&&this.currentTarget!=g&&(this.fire("out",d,this.currentTarget),this.currentTarget=g,this.fire("over",d)))):!this.gesture&&this.squared(this.pageX-this.startX)+this.squared(this.pageY-this.startY)>this.distance&&(this.holdTimer=this.clearTimer(this.holdTimer),this.clickTimer=this.clearTimer(this.clickTimer),this.horizontal=this.squared(this.pageX-this.startX)>this.squared(this.pageY-this.startY),this.left=this.horizontal?this.startX>this.pageX:this.startY>this.pageY,this.fire("over",d),this.dragged=this.fire("dragstart",d),this.moved=!0),this.prevX=this.pageX,this.prevY=this.pageY;break;case b.events.end:case b.events.cancel:if(b.is.android&&!this.started)break;if(this.started=!1,this.unbind(b.events.move),document.addEventListener&&this.unbind(b.events.end),this.holdTimer=this.clearTimer(this.holdTimer),this.holdFired){this.modifier=!1,this.fire("stop",d);break}var i=+new Date,j=this.lastTouch||i+1;if(f=i-j,this.lastTouch=i,!this.moved&&this.clickDelay>f&&f>0){this.clickTimer=this.clearTimer(this.clickTimer),this.fire("doubleclick",d),this.modifier=!1,this.fire("stop",d);break}if(!1===this.clickTimer&&!this.moved){this.clickTimer=setTimeout(function(){e.clickTimer=!1,(1>f||!(e.throttleClick&&e.clickDelay>f))&&(e.handleModifierEvents||!e.modifier)&&(e.fire("click",d),e.onclick&&e.onclick.call(e.context,d,e.originalTarget)),e.modifier=!1,e.fire("stop",d)},this.clickDelay);break}this.dragged?(this.clickTimer=this.clearTimer(this.clickTimer),this.fire("dragstop",d)):this.fire("stop",d),this.modifier=!1}}},b.multiclicker=f})(window,window.atirip||(window.atirip={}));